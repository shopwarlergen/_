<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>War Legend - Shop Game</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f5f7fa;color:#111}
.topbar{background:#444;color:#fff;display:flex;align-items:center;justify-content:space-between;padding:10px 20px;position:sticky;top:0;z-index:1000}
.topbar a{color:#fff;margin-right:15px;text-decoration:none;font-weight:700}
.topbar a:hover{color:#ffcc00}
.topbar .right{display:flex;align-items:center;gap:10px}
.top-section{background:#000;color:#fff;display:flex;justify-content:space-between;align-items:flex-start;padding:60px 50px 40px}
.top-left h1{font-size:36px;color:#ffcc00;margin:0 0 10px}
.top-right{width:280px;background:#fff;color:#000;border-radius:10px;padding:20px;box-shadow:0 3px 10px rgba(0,0,0,.2)}
.service-section{padding:40px 50px}
.service-section h2{text-align:center;font-size:26px;text-decoration:underline;margin-bottom:30px}
.cards{display:flex;gap:20px;justify-content:center;flex-wrap:wrap}
.card{width:320px;background:#fff;border:1px solid #ccc;border-radius:8px;text-align:center;box-shadow:0 2px 5px rgba(0,0,0,.1)}
.card img{width:100%;height:200px;object-fit:cover;border-radius:8px 8px 0 0}
.card h3{margin:15px 0;font-size:20px}
.btn{display:inline-block;margin:10px 0 15px;padding:8px 20px;background:orange;color:#fff;font-weight:700;text-decoration:none;border-radius:20px}
.btn:hover{background:darkorange}

/* overlays */
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.65);display:none;justify-content:center;align-items:center;z-index:2000}
.form-box{background:#fff;padding:22px;border-radius:10px;width:340px;position:relative;box-shadow:0 3px 12px rgba(0,0,0,.3);text-align:left}
.form-box h2{margin:0 0 8px;text-align:center}
.form-box input,.form-box select{width:100%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:6px;box-sizing:border-box}
.form-box button{padding:10px;width:100%;margin-top:6px;background:#007bff;color:#fff;border:none;border-radius:6px;cursor:pointer}
.form-box .close-btn{position:absolute;top:10px;right:10px;background:#e74c3c;color:#fff;padding:6px 8px;border-radius:6px;cursor:pointer}
.small-btn{display:inline-block;padding:6px 10px;border-radius:6px;background:#eee;border:1px solid #ccc;cursor:pointer;margin-left:6px}
.account-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}

/* footer */
footer{background:#f1f1f1;color:#555;text-align:center;padding:15px;font-size:14px;margin-top:20px}
</style>
</head>
<body>

<div class="topbar">
  <div>
    <a href="shop.html">ğŸ  Trang chá»§</a>
    <a href="#" onclick="toggleNap(true)">ğŸ’° Náº¡p tiá»n</a>
    <a href="#" onclick="toggleAccount(true)">ğŸ‘¤ TÃ i khoáº£n</a>
    <a href="prizes.html">ğŸ Giáº£i thÆ°á»Ÿng</a>
    <a href="admin.html" id="adminLink" style="display:none">âš™ï¸ Admin</a>
  </div>
  <div class="right">
    <span id="userInfo"></span>
    <a id="loginBtn" style="cursor:pointer">ğŸ”‘ ÄÄƒng nháº­p / ÄÄƒng kÃ½</a>
    <a id="logoutBtn" style="display:none;cursor:pointer">ğŸšª ÄÄƒng xuáº¥t</a>
  </div>
</div>

<div class="top-section">
  <div class="top-left">
    <h1>ğŸ›’ WAR LEGEND</h1>
    <p>Uy tÃ­n - Nhanh chÃ³ng - An toÃ n</p>
  </div>
  <div class="top-right">
    <h2>ğŸ† Top náº¡p tiá»n</h2>
    <ul id="topList" style="padding-left:18px;margin:8px 0"></ul>
  </div>
</div>

<div class="service-section">
  <h2>Dá»‹ch Vá»¥ CÃ y ThuÃª</h2>
  <div class="cards" id="menu">
    <div class="card">
      <img src="https://tr.rbxcdn.com/180DAY-37cc49a6bdb03b5a4394db84ff264fe5/768/432/Image/Webp/noFilter" alt="Blox Fruits">
      <h3>Blox Fruits</h3>
      <a href="bloxfruits.html" class="btn">Xem dá»‹ch vá»¥</a>
    </div>
    <div class="card">
      <img src="https://static.beebom.com/wp-content/uploads/2025/07/99-Nights-in-the-Forest-true-story-banner.jpg" alt="99 Nights">
      <h3>99 Nights in the Forest</h3>
      <a href="forest.html" class="btn">Xem dá»‹ch vá»¥</a>
    </div>
  </div>
</div>

<footer>Â© War Legend - Shop game uy tÃ­n. Náº¿u xáº£y ra lá»—i vui lÃ²ng vÃ o Discord: <a href="https://discord.gg/ypSW5Y5t" target="_blank">Discord</a></footer>

<!-- Login / Register overlay -->
<div class="overlay" id="loginOverlay">
  <div class="form-box">
    <div class="close-btn" onclick="toggleLogin(false)">âœ–</div>
    <h2 id="formTitle">ÄÄƒng nháº­p</h2>
    <input id="username" placeholder="TÃªn Ä‘Äƒng nháº­p">
    <input id="password" type="password" placeholder="Máº­t kháº©u">
    <button id="submitAuthBtn" onclick="submitForm()">ÄÄƒng nháº­p</button>
    <p id="switchText" style="text-align:center;margin-top:8px">ChÆ°a cÃ³ tÃ i khoáº£n? <a href="#" onclick="switchMode()">ÄÄƒng kÃ½</a></p>
  </div>
</div>

<!-- Nap the overlay -->
<div class="overlay" id="napOverlay">
  <div class="form-box">
    <div class="close-btn" onclick="toggleNap(false)">âœ–</div>
    <h2>Náº¡p tháº» cÃ o</h2>
    <input id="cardCode" placeholder="MÃ£ tháº» (PIN)">
    <input id="cardSerial" placeholder="Sá»‘ seri">
    <select id="cardAmount">
      <option value="">-- Chá»n má»‡nh giÃ¡ --</option>
      <option value="10000">10,000 VNÄ</option>
      <option value="20000">20,000 VNÄ</option>
      <option value="50000">50,000 VNÄ</option>
      <option value="100000">100,000 VNÄ</option>
    </select>
    <button onclick="napThe()">XÃ¡c nháº­n</button>
  </div>
</div>

<!-- Account overlay -->
<div class="overlay" id="accountOverlay">
  <div class="form-box">
    <div class="close-btn" onclick="toggleAccount(false)">âœ–</div>
    <h2>TÃ i khoáº£n</h2>
    <div id="accInfo"></div>
  </div>
</div>

<script>
/* Dá»¯ liá»‡u máº«u + helpers */
const storage = {
  getUsers(){ return JSON.parse(localStorage.getItem('users')||'[]') },
  setUsers(u){ localStorage.setItem('users', JSON.stringify(u)) },
  getCurrent(){ return JSON.parse(localStorage.getItem('currentUser')||'null') },
  setCurrent(u){ localStorage.setItem('currentUser', JSON.stringify(u)) },
  removeCurrent(){ localStorage.removeItem('currentUser') }
};

// Khá»Ÿi táº¡o owner máº·c Ä‘á»‹nh náº¿u chÆ°a cÃ³
(function initDefault(){
  const defaultOwner = { username: "shopwarlergen@gmail.com", password: "kietgottop2", role: "owner", balance:0, totalNap:0 };
  let users = storage.getUsers();
  if(!users.find(u=>u.username===defaultOwner.username)){
    users.push(defaultOwner);
    storage.setUsers(users);
  }
})();

/* Overlay toggles */
function toggleLogin(show){
  document.getElementById('loginOverlay').style.display = show ? 'flex' : 'none';
  if(show){
    // reset form
    document.getElementById('username').value='';
    document.getElementById('password').value='';
    isLogin = true;
    renderAuthMode();
  }
}
function toggleNap(show){ document.getElementById('napOverlay').style.display = show ? 'flex' : 'none'; }
function toggleAccount(show){
  const el = document.getElementById('accountOverlay');
  el.style.display = show ? 'flex' : 'none';
  if(show) renderAccount();
}

/* Auth (login/register) */
let isLogin = true;
function switchMode(){ isLogin = !isLogin; renderAuthMode(); }
function renderAuthMode(){
  document.getElementById('formTitle').innerText = isLogin ? 'ÄÄƒng nháº­p' : 'ÄÄƒng kÃ½';
  document.getElementById('submitAuthBtn').innerText = isLogin ? 'ÄÄƒng nháº­p' : 'ÄÄƒng kÃ½';
  document.getElementById('switchText').innerHTML = isLogin
    ? 'ChÆ°a cÃ³ tÃ i khoáº£n? <a href="#" onclick="switchMode()">ÄÄƒng kÃ½</a>'
    : 'ÄÃ£ cÃ³ tÃ i khoáº£n? <a href="#" onclick="switchMode()">ÄÄƒng nháº­p</a>';
}

function submitForm(){
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  if(!username || !password){ alert('âš ï¸ Nháº­p Ä‘áº§y Ä‘á»§!'); return; }
  let users = storage.getUsers();

  if(isLogin){
    const user = users.find(u => u.username === username && u.password === password);
    if(user){
      storage.setCurrent(user);
      alert('âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng!');
      toggleLogin(false);
      refreshUI();
    } else {
      alert('âŒ Sai tÃªn hoáº·c máº­t kháº©u!');
    }
  } else {
    if(users.find(u => u.username === username)){ alert('âš ï¸ TÃ i khoáº£n Ä‘Ã£ tá»“n táº¡i!'); return; }
    const newUser = { username, password, role:'user', balance:0, totalNap:0 };
    users.push(newUser);
    storage.setUsers(users);
    storage.setCurrent(newUser);
    alert('âœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng!');
    toggleLogin(false);
    refreshUI();
  }
}

/* Nap the */
let validCards = [
  {code:"111111",serial:"AAA111",amount:10000},
  {code:"222222",serial:"BBB222",amount:20000},
  {code:"333333",serial:"CCC333",amount:50000},
  {code:"444444",serial:"DDD444",amount:100000}
];

function napThe(){
  const code = document.getElementById('cardCode').value.trim();
  const serial = document.getElementById('cardSerial').value.trim();
  const amount = parseInt(document.getElementById('cardAmount').value) || 0;
  if(!code || !serial || !amount){ alert('âš ï¸ Nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin!'); return; }

  const idx = validCards.findIndex(c=>c.code===code && c.serial===serial);
  if(idx===-1){ alert('âŒ MÃ£ tháº» hoáº·c seri khÃ´ng Ä‘Ãºng!'); return; }
  const card = validCards[idx];
  if(card.amount !== amount){ alert('âš ï¸ Sai má»‡nh giÃ¡, tháº» sáº½ bá»‹ há»§y!'); validCards.splice(idx,1); return; }

  const cur = storage.getCurrent();
  if(!cur){ alert('âŒ Báº¡n chÆ°a Ä‘Äƒng nháº­p!'); return; }

  // cáº­p nháº­t users vÃ  current
  let users = storage.getUsers();
  const uIndex = users.findIndex(u => u.username === cur.username && u.password === cur.password);
  if(uIndex > -1){
    users[uIndex].balance = (users[uIndex].balance || 0) + amount;
    users[uIndex].totalNap = (users[uIndex].totalNap || 0) + amount;
    storage.setUsers(users);
    storage.setCurrent(users[uIndex]);
    alert('âœ… Náº¡p thÃ nh cÃ´ng! +' + amount.toLocaleString() + ' VNÄ');
    validCards.splice(idx,1);
    toggleNap(false);
    refreshUI();
  } else {
    alert('âŒ KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i dÃ¹ng trong há»‡ thá»‘ng!');
  }
}

/* Account render */
function renderAccount(){
  const target = document.getElementById('accInfo');
  const cur = storage.getCurrent();
  if(!cur){
    target.innerHTML = 'Báº¡n chÆ°a Ä‘Äƒng nháº­p.<br><br><button class="small-btn" onclick="toggleLogin(true); toggleAccount(false)">ğŸ”‘ ÄÄƒng nháº­p / ÄÄƒng kÃ½</button>';
    return;
  }
  const uname = cur.username || '(chÆ°a Ä‘áº·t tÃªn)';
  const pwdMasked = 'â—â—â—â—â—â—';
  target.innerHTML = `
    <div><strong>ğŸ‘¤ TÃªn:</strong> ${escapeHtml(uname)}</div>
    <div class="account-row"><strong>ğŸ”‘ Máº­t kháº©u:</strong>
      <span id="pwdText">${pwdMasked}</span>
      <button class="small-btn" onclick="toggleReveal()">Hiá»‡n</button>
    </div>
    <div><strong>ğŸ’° ÄÃ£ náº¡p:</strong> ${(cur.totalNap||0).toLocaleString()} VNÄ</div>
    <div><strong>ğŸ’³ Sá»‘ dÆ°:</strong> ${(cur.balance||0).toLocaleString()} VNÄ</div>
    <div style="margin-top:8px">
      <button class="small-btn" onclick="logout()">ÄÄƒng xuáº¥t</button>
    </div>
  `;
}

/* reveal password toggle (client-side only) */
function toggleReveal(){
  const cur = storage.getCurrent();
  if(!cur) return;
  const el = document.getElementById('pwdText');
  if(el.innerText === 'â—â—â—â—â—â—') el.innerText = cur.password;
  else el.innerText = 'â—â—â—â—â—â—';
}

/* UI helpers */
function refreshUI(){
  const cur = storage.getCurrent();
  const userInfo = document.getElementById('userInfo');
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const adminLink = document.getElementById('adminLink');

  if(cur){
    userInfo.innerText = 'Xin chÃ o ' + (cur.username || '(user)');
    loginBtn.style.display = 'none';
    logoutBtn.style.display = 'inline-block';
    logoutBtn.onclick = logout;
    if(cur.role === 'admin' || cur.role === 'owner') adminLink.style.display = 'inline-block';
    else adminLink.style.display = 'none';
  } else {
    userInfo.innerText = '';
    loginBtn.style.display = 'inline-block';
    logoutBtn.style.display = 'none';
    loginBtn.onclick = () => toggleLogin(true);
    adminLink.style.display = 'none';
  }
  loadTop();
}

function logout(){
  storage.removeCurrent();
  refreshUI();
  toggleAccount(false);
  alert('âœ… ÄÃ£ Ä‘Äƒng xuáº¥t.');
}

/* Top list */
function loadTop(){
  const ul = document.getElementById('topList');
  const users = storage.getUsers().slice().sort((a,b)=>(b.balance||0)-(a.balance||0));
  ul.innerHTML = users.slice(0,5).map((u,i)=>`<li>${i+1}. ${escapeHtml(u.username)} - ğŸ’° ${(u.balance||0).toLocaleString()} VNÄ</li>`).join('');
}

/* small utilities */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* init on load */
document.addEventListener('DOMContentLoaded', function(){
  refreshUI();
  // attach account open to click in header
  document.querySelectorAll('[onclick*="toggleAccount"]').forEach(el=>el.addEventListener('click', e=>{ e.preventDefault(); toggleAccount(true); }));
});
</script>

</body>
</html>